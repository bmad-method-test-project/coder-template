name: Conventional PR Title

on:
  pull_request_target:
    types:
      - opened
      - reopened
      - edited
      - synchronize
      - ready_for_review

permissions:
  pull-requests: write

jobs:
  lint:
    name: Validate PR title
    runs-on: ubuntu-latest
    if: ${{ !github.event.pull_request.draft }}

    steps:
      - name: Check PR title matches Conventional Commits
        id: semantic
        uses: amannn/action-semantic-pull-request@v6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          types: |
            feat
            fix
            perf
            refactor
            docs
            test
            build
            ci
            chore
            revert
          requireScope: false

      - name: Explain failure on PR
        if: ${{ failure() }}
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          header: conventional-pr-title
          message: |
            This pull request is blocked because the PR title is not a valid **Conventional Commit** header.

            Error:
            ```
            ${{ steps.semantic.outputs.error_message }}
            ```

            Allowed formats:
            - `feat: ...` (minor)
            - `fix: ...` (patch)
            - `feat!: ...` or `feat(scope)!: ...` (major)

            See the PR template for the full list of allowed types and examples.
